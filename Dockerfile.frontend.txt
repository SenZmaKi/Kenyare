FROM node:20-alpine

# Install system dependencies
RUN apk add --no-cache \
    poppler-utils \
    wget \
    && rm -rf /var/cache/apk/*

WORKDIR /kenyare

# Copy package files
COPY package.json pnpm-lock.yaml* ./

# Install pnpm and dependencies
RUN npm install -g pnpm && pnpm install

# Copy source code
COPY . .

# Create non-root user
RUN addgroup -S kenyare_group && adduser -S kenyare_user -G kenyare_group
USER kenyare_user

EXPOSE 5173

# Run in dev mode instead of preview
CMD ["pnpm", "run", "dev", "--host", "0.0.0.0"]

# Image metadata
LABEL name="kenyare-frontend" version="1.0"